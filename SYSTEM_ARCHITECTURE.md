# 🏗️ АРХИТЕКТУРНАЯ ДИАГРАММА СИСТЕМЫ МОНИТОРИНГА КТГ

## 📊 Общая схема системы

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           СИСТЕМА МОНИТОРИНГА КТГ                              │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   МЕДИЦИНСКОЕ   │    │   МЕДИЦИНСКОЕ   │    │   МЕДИЦИНСКОЕ   │
│   ОБОРУДОВАНИЕ  │    │   ОБОРУДОВАНИЕ  │    │   ОБОРУДОВАНИЕ  │
│   (КТГ-1)       │    │   (КТГ-2)       │    │   (КТГ-N)       │
└─────────┬───────┘    └─────────┬───────┘    └─────────┬───────┘
          │                      │                      │
          │                      │                      │
          ▼                      ▼                      ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              FRONTEND LAYER                                    │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   REACT APP     │  │   CHART.JS      │  │   REDUX STORE   │                │
│  │   (UI/UX)       │  │   (GRAPHS)      │  │   (STATE)       │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
└─────────────────────────────────────────────────────────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              NGINX PROXY                                       │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   STATIC FILES  │  │   GZIP COMPRESS │  │   CACHE CONTROL │                │
│  │   (FRONTEND)    │  │   (PERFORMANCE) │  │   (OPTIMIZATION)│                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
└─────────────────────────────────────────────────────────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              API LAYER                                         │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   FASTAPI       │  │   SSE STREAMS   │  │   AUTHENTICATION│                │
│  │   (REST API)    │  │   (REAL-TIME)   │  │   (JWT TOKENS)  │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
└─────────────────────────────────────────────────────────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              ML ENGINE                                         │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   SKLEARN       │  │   ONNX RUNTIME  │  │   FORECASTING   │                │
│  │   (CLASSIFICATION)│  │   (INFERENCE)  │  │   (PREDICTIONS) │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
└─────────────────────────────────────────────────────────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              DATA LAYER                                        │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   MONGODB       │  │   REDIS CACHE   │  │   FILE STORAGE  │                │
│  │   (PATIENTS)    │  │   (SESSIONS)    │  │   (MODELS)      │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
└─────────────────────────────────────────────────────────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              EXTERNAL SERVICES                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   TELEGRAM BOT  │  │   EXTERNAL API  │  │   HL7/FHIR      │                │
│  │   (NOTIFICATIONS)│  │   (INTEGRATION) │  │   (STANDARDS)   │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🔄 Поток данных

### 1. Сбор данных:
```
Медицинское оборудование → Датчики → Аналоговые сигналы → Цифровые данные
```

### 2. Обработка данных:
```
Цифровые данные → Фильтрация → Нормализация → Извлечение признаков → ML анализ
```

### 3. Визуализация:
```
ML результаты → API → Frontend → Графики → Пользователь
```

### 4. Уведомления:
```
Критические состояния → Telegram Bot → Медицинский персонал
```

## 🧠 ML Pipeline

### 1. Предобработка:
```
Raw Data → Noise Filtering → Normalization → Feature Extraction → ML Input
```

### 2. Классификация:
```
ML Input → Gradient Boosting → Pathology Detection → Risk Assessment
```

### 3. Прогнозирование:
```
Time Series → Random Forest → Future Predictions → Trend Analysis
```

### 4. Оптимизация:
```
ML Models → ONNX Conversion → Quantization → Edge Deployment
```

## 🔧 Технологический стек

### Frontend:
- **React 18**: Компонентный UI
- **TypeScript**: Типизация
- **Chart.js**: Графики
- **Redux Toolkit**: State management
- **Vite**: Сборка

### Backend:
- **Python 3.12**: Основной язык
- **FastAPI**: Web framework
- **Uvicorn**: ASGI server
- **Pydantic**: Валидация данных

### ML:
- **Scikit-learn**: Классические ML
- **ONNX Runtime**: Оптимизированный инференс
- **Pandas/NumPy**: Обработка данных
- **Joblib**: Сериализация моделей

### Database:
- **MongoDB**: Основная БД
- **Redis**: Кэширование
- **File System**: Модели и данные

### DevOps:
- **Docker**: Контейнеризация
- **Docker Compose**: Оркестрация
- **Nginx**: Веб-сервер
- **Git**: Контроль версий

## 📊 Компоненты системы

### 1. Frontend (React App):
- **MainBlock**: Главный компонент
- **FetalMonitor**: Мониторинг КТГ
- **PatientManagement**: Управление пациентами
- **Charts**: Визуализация данных

### 2. Backend (FastAPI):
- **realtime_api.py**: Основной API
- **realtime_predictor.py**: ML предиктор
- **fetal_ml_model.py**: ML модели
- **telegram_bot.py**: Telegram бот

### 3. ML Engine:
- **Классификация**: Gradient Boosting
- **Прогнозирование**: Random Forest
- **Оптимизация**: ONNX Runtime
- **Кэширование**: Результаты инференса

### 4. Database:
- **Patients**: Данные пациентов
- **Sessions**: Сессии мониторинга
- **Predictions**: Результаты ML
- **Logs**: Системные логи

## 🔄 Жизненный цикл данных

### 1. Создание пациента:
```
User Input → API → Validation → MongoDB → Response
```

### 2. Запуск мониторинга:
```
Patient ID → External API → Token → Session Start → Data Stream
```

### 3. Обработка данных:
```
Raw Data → ML Pipeline → Predictions → Database → Frontend
```

### 4. Уведомления:
```
Critical State → Telegram Bot → Medical Staff → Action
```

## 🚀 Развертывание

### 1. Локальное:
```bash
docker-compose up -d
```

### 2. Продакшн:
```bash
docker-compose -f docker-compose.prod.yml up -d
```

### 3. Облачное:
```bash
kubectl apply -f k8s/
```

## 📈 Масштабирование

### 1. Горизонтальное:
- Добавление серверов
- Load balancing
- Микросервисы

### 2. Вертикальное:
- Увеличение ресурсов
- Оптимизация кода
- Кэширование

### 3. ML оптимизация:
- ONNX модели
- Квантизация
- Батчинг

## 🔒 Безопасность

### 1. Аутентификация:
- JWT токены
- Роли пользователей
- Права доступа

### 2. Защита данных:
- TLS шифрование
- Анонимизация
- Аудит действий

### 3. Мониторинг:
- Health checks
- Логирование
- Алерты

---

**Версия**: 1.0  
**Дата**: 2024-01-15  
**Автор**: Команда разработки
